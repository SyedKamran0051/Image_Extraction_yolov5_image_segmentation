import jwt
from database_connection import DatabaseConnection

SECRET_KEY = "secret_key_placeholder"  # This should be a secure random value in a real application

class LoginService:
    def __init__(self, db_path):
        self.db_path = db_path

    def authenticate_user(self, username, password):
        # Check credentials against database
        db = DatabaseConnection(self.db_path)
        cursor = db.connect()
        cursor.execute("SELECT * FROM users WHERE username = ? AND password = ?", (username, password))
        user = cursor.fetchone()
        db.close()

        if user:
            # If user exists, create a JWT token
            payload = {
                'exp': datetime.utcnow() + timedelta(days=1),
                'iat': datetime.utcnow(),
                'sub': user[0]  # user ID
            }
            token = jwt.encode(payload, SECRET_KEY, algorithm='HS256').decode('utf-8')
            return {"message": "Login successful", "token": token}
        else:
            return {"message": "Invalid credentials"}